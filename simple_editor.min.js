/**
 * simple-editor - Medium.com like editor with plugin architecture
 * @author     James Nicol
 * @link       undefined
 * @license    MIT
 */
!function(t,e){"use strict";if("function"==typeof define&&define.amd)define(["jquery"],function(i){return e(t,i)});else if("undefined"!=typeof exports){var i=require("jquery");module.exports=e(t,i)}else t.SimpleEditor=e(t,t.jQuery)}(this,function(t,e){"use strict";var i=Object.prototype.hasOwnProperty,o={_canLog:!1,detectDebugMode:function(){if(window){var t,e;if(!i.call(window,"console"))return;t=this,e=window.location.search.replace(/^\?/,"").split("&");for(var o in e){var n=e[o];/^log=/.test(n)&&(t._canLog=!0)}}},log:function(){this._canLog&&console.log.apply(console,arguments)}};o.detectDebugMode();var n={tidy:function(){this._removeComments(),this._removeTags(),this._removeAttrs()},_reTidy:function(){var t=this;this._retidyTimer=setInterval(function(){t.$target.find("p[style]").length>0&&(t.tidy(),clearInterval(t._retidyTimer))},100)},_removeComments:function(){var t=this.$target.html();t=t.replace(/<!--[\s\S]*?-->/g,""),t=e.trim(t),this.$target.html(t)},_removeTags:function(){var t=this;this.$target.find("*").each(function(i,o){var n=o.tagName.toLowerCase();-1===e.inArray(n,t.options.tagWhiteList)&&e(o).remove()})},_removeAttrs:function(){var t=e.map(this.options.tagWhiteList,function(t){return"a"!==t||"img"!==t?t.toLowerCase():void 0});this.$target.find(t.join(", ")).each(function(t,i){for(var o=0;o<i.attributes.length;o++){var n=i.attributes[o].name;e(i).removeAttr(n)}}),this.$target.find("a").each(function(t,i){for(var o=0;o<i.attributes.length;o++){var n=i.attributes[o].name;("href"!==n||"target"!==n)&&e(i).removeAttr(n)}})}},r={bold:function(){document.execCommand("bold")},italic:function(){document.execCommand("italic")},unorderedList:function(){document.execCommand("insertUnorderedList")},heading:function(){document.execCommand("formatBlock",!1,"<"+this.options.headingElement+">")},paragraph:function(){document.execCommand("formatBlock",!1,"<P>")},link:function(t){document.execCommand("createLink",!1,t),this.options.linkTarget.length>0&&this.$target.find("a").prop("target","_blank")},unlink:function(){document.execCommand("unlink")},undo:function(){document.execCommand("undo")},redo:function(){document.execCommand("redo")},img:function(t){document.execCommand("insertImage",!1,t)}},a=function(t,i){if(i=i||{},this.$target=e(t),0===this.$target.length)throw"The editor needs a valid target!";this.target=this.$target[0],this.hasPlaceholder=!1,this.options={css:{target:i.cssClass||"f-content-section",placeholder:i.placeholderClass||"f-fc-medium f-font-italic f-fs-large"},headingElement:(i.headingElement||"h2").toUpperCase(),minHeight:i.minHeight||100,linkTarget:i.linkTarget||"_blank",placeholder:i.placeholder||this.$target.attr("placeholder")||null,placeholderClass:i.placeholderClass||"SimpleEditor-placeholder"},this.options.tagWhiteList=i.tagWhiteList||["p","b","strong","i","em","span","br","ul","li","a",this.options.headingElement],this._setupTarget(),this._placeholder(),this._keyboardListeners(),this.log("Simple Editor initialized!",t)};return a.prototype={_setupTarget:function(){this.$target.wrap('<div class="js-simple-editor-wrapper"></div>'),e(".js-simple-editor-wrapper").css({position:"relative",backgroundColor:this.$target.css("backgroundColor"),minHeight:this.options.minHeight}),this.$target.addClass(this.options.css.target),this.$target.prop("contentEditable",!0),this.$target.css({position:"absolute",top:0,left:0,outline:"none",width:"100%",minHeight:this.options.minHeight,backgroundColor:"transparent"})},_keyboardListeners:function(){var t=this;this.$target.on("paste",null,function(){setTimeout(function(){t.tidy(),t._reTidy()},100)}),this.$target.on("keydown",function(e){e.metaKey===!0&&(98===e.which&&t.bold(),105===e.which&&t.italic()),t.hasPlaceholder&&!t.isEmpty()&&t._removePlaceholder()}),this.$target.on("keyup",function(){var e=window.getSelection?window.getSelection().anchorNode:document.activeElement;e&&e.parentNode===t.target,t._placeholder()})},_placeholder:function(){if(this.options.placeholder&&this.isEmpty()&&this.options.placeholder&&!this.hasPlaceholder){var t='<div contenteditable="false" ';t+='class="'+this.options.placeholderClass+" ",t+=this.options.css.placeholder+'" ',t+='style="position:absolute;top:0;left:0;width:105%" ',t+='">',t+=this.options.placeholder,t+="</div>",this.$target.parent().prepend(t),this.hasPlaceholder=!0}},_removePlaceholder:function(){this.$target.parent().find("."+this.options.placeholderClass).remove(),this.hasPlaceholder=!1},isEmpty:function(){var t=this.$target.text();return 0===e.trim(t).length},contents:function(){return e.trim(this.$target.html())}},e.extend(a.prototype,o,n,r),a.VERSION="0.0.1",a});